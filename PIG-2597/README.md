Title: (PIG-2597) Move Grunt from JavaCC to ANTLR
--

Abstract
--
Currently, Pig utilizes two frameworks for generating language processors.
Grunt, an interactive command-line interface for Pig, is implemented
using JavaCC. But query scripts are parsed by ANTLR-based QueryParser.
This status is problematic due to the following reasons.
First, using two different parser generators in one project is
confusing to developers, especially new ones.
Second, even for experienced contributors, understanding both frameworks
and maintaining dependencies in build processes are burdensome. 
Third, the different implementations of Grunt and QueryParser hamper adding
new features. For example, it was not possible to use Grunt commands such as
`register` in Pig Macro until a workaround patch was committed.

In this Google Summer of Code project, I will solve the above problem
by reimplementing Grunt and merging Grunt implementation with QueryParser. 
Removing Grunt's dependency on JavaCC will help Apache Pig project keep clean,
easy to maintain codebase and continue to be improved by many contributors. 

Benefits to Community
--
 * Implementing Grunt using ANTLR removes legacy dependency on JavaCC and
 offers a better opportunity to fix bugs and add new features.
 * By merging two parsers into a single implementation, Pig will have
 a consolidated, easy to understand codebase, which is essential for 
 successful open-source projects.

Project Goals (Deliverables)
--
During the Google Summer of Code program, I will finish

 * Design and implementation of ANTLR-based Grunt shell and related codebase
 such as ParameterSubstitutionPreprocessor,
 * Design and implementation of a test class for Grunt, and
 * Documentation of the code so that new developers can easily understand and
   change Grunt later.

The final deliverables will be in the form of patches to the trunk of Apache
Pig code repository.

Design and Approach
--
Current Grunt processes inputs via `class GruntParser`. Roughly, there are two
flows:
 
 * Command processing: `processCMD(String cmd, ...)` processes CMD, any command
   supported by Grunt shell, such as `cat`, `explain`, and etc.
   These methods are called from `class PigScriptParser`, a JavaCC generated
   parser and GruntParser's superclass, as soon as being recognized.
 * Query processing: If a given string is not a command,
   `processPig(String cmd)`
   registers the query via `PigServer`, and eventually queries will be
   processed by ANTLR-generated query processors
   (`QueryLexer`, `QueryParser`, `AstValidator`, `LogicalPlanGenerator`, ...).

First of all, this approach is not easy to understand without a proper
background. Even after a developer understood, changing and/or adding features
to those parts is difficult. For example, a macro definition is processed by
ANTLR-generated parser, but the macro could include a command that should be
processed by GruntParser. This specific problem was solved by a workaround
that supplements QueryParser with codes which handle Grunt commands.
But a better approach would be having a consolidated parser for both 
Grunt commands and Pig script.

The new Grunt implementation will be integrated into `QueryParser`.

Each Grunt command definition will be added to 
in Grunt will be defined in a new grammar code for ANTLR. 
But each method actually processes the command can remail as much as possible.
For example, the following grammar definition, even though it is not accurate,
can define `rm` command in Grunt:
```
remove
    :    'rm' path=ID
         {parser.processRemove($path.text, null);}
    ;
```

This way, minimal code changes and additions are required for the new 
implementation.

Also, replacing preprocessor (ParameterSubstitutionPreprocessor) with
ANTLR based implementation needs to be done.
`class ParameterSubstitutionPreprocessor` uses `PigFileParser`,
which is also generated by JavaCC, to substitute paramters into a query
script.

Timeline
--
 * First month (May 19 ~ June 18): Implement a test class for at least a few
   Grunt commands and parser for the commands. This will make sure the
   development is on track with a right direction. 
 * Second month (June 19 ~ July 18): Fix the problems (if any) from the first
   month. Continue adding commands to the implementation. 
 * Final month (July 19 ~ August 18): Ask the community for review and test
   code and documentation.

About Me
--
I am a fourth year PhD student in computer science at SUNY Buffalo. My main
research interest lies in distributed data processing systems. Currently I am
developing a wide-area data processing system that adapts Pig Latin script
language for describing data flows. 

Thanks to my research experience, I have a good understanding of how Pig
processes Grunt shell commands and Pig Latin scripts, generates logical plans,
and how the logical plan is translated into MapReduce jobs.
I am knowledgeable in developing Hadoop MapReduce
applications and installing Hadoop MapReduce/HBase cluster. 

Since early 2013, I have been following Pig development list. 
I reported bugs and submitted patches [1][2] and particpated in discussions [3]
even though they were minor issues.

Before my graduate studies, I had been a software developer for more than 4
years. I am familiar with (distributed) version control systems such as git and
subversion. 

[1] https://issues.apache.org/jira/browse/PIG-3166

[2] https://issues.apache.org/jira/browse/PIG-3816

[3] https://issues.apache.org/jira/browse/PIG-3809

Contact Info
--
 * e-mail: kyungho.jeon@gmail.com
 * www: http://www.cse.buffalo.edu/~kyunghoj

